# Conditional Access Policy Audit Template
# Comprehensive review of Azure AD Conditional Access policies

name: "Conditional Access Policy Audit"
description: "Full audit of Conditional Access policies including coverage gaps, risky configurations, and compliance alignment"
version: "1.0.0"
author: "FARA-GRC Team"
tags: ["conditional-access", "azure-ad", "zero-trust", "compliance"]

# Audit scope and parameters
audit_scope:
  tenant_id: "${TENANT_ID}"
  portals:
    - "Entra ID Admin Center"
    - "Microsoft 365 Defender"
  
  checks:
    - name: "Policy Coverage Analysis"
      type: "conditional_access_policy"
      portal: "Entra ID"
      path: "/conditional-access/policies"
      criteria:
        coverage: "all_users"
        apps: "all_cloud_apps"
      expected: true
      severity: "high"
      description: "Verify CA policies cover all users and cloud applications"

    - name: "Break Glass Account Exclusions"
      type: "conditional_access_policy"
      portal: "Entra ID"
      path: "/conditional-access/policies"
      criteria:
        excluded_users: "emergency_access_accounts"
      expected: true
      severity: "critical"
      description: "Emergency access accounts should be excluded from all blocking policies"

    - name: "Location-Based Policies"
      type: "conditional_access_policy"
      portal: "Entra ID"
      path: "/conditional-access/named-locations"
      criteria:
        named_locations_defined: true
        trusted_locations_configured: true
      expected: true
      severity: "medium"
      description: "Named and trusted locations should be configured for geo-blocking"

    - name: "Device Compliance Requirements"
      type: "conditional_access_policy"
      portal: "Entra ID"
      path: "/conditional-access/policies"
      criteria:
        grant_controls: "require_compliant_device"
      expected: true
      severity: "high"
      description: "Policies should require device compliance for sensitive apps"

    - name: "Sign-in Risk Policy"
      type: "conditional_access_policy"
      portal: "Entra ID"
      path: "/conditional-access/policies"
      criteria:
        conditions: "sign_in_risk"
        risk_levels: ["high", "medium"]
      expected: true
      severity: "high"
      description: "Sign-in risk should trigger additional authentication"

    - name: "User Risk Policy"
      type: "conditional_access_policy"
      portal: "Entra ID"
      path: "/conditional-access/policies"
      criteria:
        conditions: "user_risk"
        risk_levels: ["high"]
        grant_controls: "require_password_change"
      expected: true
      severity: "critical"
      description: "High-risk users should be required to change password"

# Execution settings
execution:
  approval_policy: "auto-conservative"
  max_iterations: 75
  timeout_minutes: 45
  output_format: "forensic_bundle"

# Evidence requirements
evidence:
  screenshots: true
  api_responses: true
  chain_of_thought: true
  timestamps: true
  policy_export: true  # Export policy JSON for comparison

# Reporting
reporting:
  format: "detailed_technical"
  include_recommendations: true
  compliance_mapping:
    - "NIST CSF"
    - "CIS Controls"
    - "ISO 27001"
  risk_scoring: "bayesian"
